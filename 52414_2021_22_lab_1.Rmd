---
title: "52414 - lab 1 Solutions"
author: "Halit Cohen and Yoray Mauda"
date: "25/4/2022"
output: html_document
---


```{r, include=FALSE}
library(tidyverse) # This includes dplyr, stringr, ggplot2, ..
library(dplyr)
library(data.table)
library(rworldmap) # world map
library(ggthemes)
library(reshape2) # melt: change data-frame format long/wide
library(e1071) # skewness and kurtosis
library(RColorBrewer)

```  

**Solution:**  

1. In this section, we will load the data frame, and will compute basic processing. Plus, we will list a table the top five dates as requested. 
```{r} 

# a. Loading the data:
df <- read.csv("https://raw.githubusercontent.com/DataScienceHU/r52414_2021_22_lab1-Mauda_Yoray_and_Cohen_Halit/main/owid-covid-data.csv")

# Modifying date because its in "character" class.
df$date <- as.Date(df$date,origin = "%Y-%m-%d")
class(df$date)
# b. Listing five top dates
High_income_new_cases <- filter(df,location == "High income")%>%
arrange(desc(new_cases))
top_n(High_income_new_cases[c("date","new_cases")],5)

High_income_new_deaths <- filter(df,location == "High income")%>%
  arrange(desc(new_deaths))
top_n(High_income_new_cases[c("date","new_deaths")],5)

High_income_new_vaccinations <- filter(df,location == "High income")%>%
  arrange(desc(new_vaccinations))
top_n(High_income_new_cases[c("date","new_vaccinations")],5)

```
[Solution text - description of analysis and results]


2. In this Question, we will compute a function that plots high and low income in one graph, as a function of date. 
```{r}
# a. Here we create the function
#להתייחס עריכם חסרין ולכתוב הסבר
function_question2 <- function(data_frame, col_name)
{
  filtered_covid_data_high <- data_frame %>% filter(location == "High income")
  filtered_covid_data_low <- data_frame %>% filter(location == "Low income")
  ggplot(filtered_covid_data_high, aes(date, {{col_name}})) + geom_point() +
    geom_point(data = filtered_covid_data_low, colour = "red")
}
# b. In this sub-question, we create four more plots based on demand
plot_1 <- function_question2(df,new_cases_per_million)
plot_1
plot_2 <- function_question2(df,new_cases_smoothed_per_million)
plot_2
plot_3 <- function_question2(df,new_deaths_smoothed)
plot_3
plot_4 <- function_question2(df,new_vaccinations_smoothed)
plot_4

```
[Solution text - description of analysis and results]

3. [Solution text - explanations] 
```{r} 
"a"

df_c<-df%>%fill(c("continent","total_cases_per_million","total_vaccinations_per_hundred","people_fully_vaccinated_per_hundred","total_boosters_per_hundred","excess_mortality_cumulative_per_million","total_deaths_per_million","date"), .direction = 'down')
current <-df_c[c("location","continent","total_cases_per_million","total_vaccinations_per_hundred","people_fully_vaccinated_per_hundred","total_boosters_per_hundred","excess_mortality_cumulative_per_million","total_deaths_per_million","date")] %>%group_by(location)%>%slice(which.max(date))

"b"
"Does this histogram look close to the normal distribution? Compute the skewness and kurtosis for this distribution, and explain what they mean about the empirical distribution of the data."
"צריך להוסיף פה הסבר על הגרף"
ggplot(current, aes(x=total_deaths_per_million))+geom_histogram(bins = 30)+labs(x="total deaths per million", y="Frequency")
tdpm <- current$total_deaths_per_million
tdpm[tdpm == ""]<-NA
tdpm_1<-na.omit(tdpm)
skewness<-skewness(tdpm_1)
kurtosis<-kurtosis(tdpm_1)
skewness
kurtosis

"c"
"What is the slope and what does it represent?"
ggplot(current,aes( x=total_cases_per_million, y=total_deaths_per_million))+geom_point()+
   geom_smooth(method=lm,se=FALSE)
lm(current$total_deaths_per_million~current$total_cases_per_million)

```
[Solution text - description of analysis and results]

4. [Solution text - explanations] 
```{r} 
"לאחר התסכלות שטחית על המידע ניתן לראות קטגוריית היבשות אינה מוזנת באוםן נכון וחלק מפרטיה נמתאים בשדה מירום ולכן נבצע קודם סידור של הנתונים"
"Find two outlier countries (can be of any continent) and write their name and value."
"a"
current_q4 <- current[c("continent","total_vaccinations_per_hundred")]
current_q4[current_q4 ==""]<- NA
current_q4 <-na.omit(current_q4)
ggplot(current_q4, aes(x = continent, y = total_vaccinations_per_hundred,fill=continent)) + geom_boxplot()


"b"
"and describe the results"
df_q4 <-df
booster_ratio <-df$total_boosters/df$people_fully_vaccinated
df$Added_Column <-booster_ratio
df_q4 <- df[c("Date","booster_ratio","continent")]
ggplot(df,aes(x=date,y=booster_ratio,color=continent))+geom_point()+labs(title = "booster ratio and continent",x="Date", y="booster_ratio")

```
[Solution text - description of analysis and results]

5. [Solution text - explanations] 
```{r} 
# Solution code in R 
# create helper columns
reduced_df = subset(df, continent != '')
reduced_df$year <- strftime(reduced_df$date, "%Y")
reduced_df$month <- strftime(reduced_df$date, "%m")

# aggregate data from each month (all the days)
agg_reduced_df <- aggregate(new_cases_per_million ~ month + year + location, reduced_df, FUN = sum)
agg_reduced_df$date <- with(agg_reduced_df, paste(year, month,sep="-"))


agg_reduced_df %>% ggplot(aes(x= month, y= new_cases_per_million)) +
  geom_boxplot(outlier.colour = "green") + facet_wrap(~year, ncol=3) +
  labs(title = "Number of Total Cases Per Million for Each Month",
       subtitle = "Data Plotted by Year", y= "Total Cases", x= "Month")
```
[Solution text - description of analysis and results]

6. [Solution text - explanations] 
```{r} 

# Solution code in R 

```
[Solution text - description of analysis and results]

7. [Solution text - explanations] 
```{r} 
" Describe the resulting maps in a couple of sentences."
"נסדר את המידע  כדי שלכל מדינה יהיה ערך יחיד"
mapdata_deaths<-df[c("location","total_deaths_per_million")]%>%group_by(location)%>%slice(which.max(total_deaths_per_million))
mapdata_vaccinations<-df[c("location","total_vaccinations_per_hundred")]%>%group_by(location)%>%slice(which.max(total_vaccinations_per_hundred))
mapdata_mortality<-df[c("location","excess_mortality_cumulative_per_million")]%>%group_by(location)%>%slice(which.max(excess_mortality_cumulative_per_million))



map_world_deaths<-joinCountryData2Map(mapdata_deaths,joinCode = "NAME",nameJoinColumn = "location")
colourpalette<-brewer.pal(8,'Accent')
mapCountryData(map_world_deaths,nameColumnToPlot = 'total_deaths_per_million',catMethod = 'fixedwidth',colourPalette=colourpalette,numCats = 400)

map_world_vaccinations<-joinCountryData2Map(mapdata_vaccinations,joinCode = "NAME",nameJoinColumn = "location")
mapCountryData(map_world_vaccinations,nameColumnToPlot = 'total_vaccinations_per_hundred',catMethod = 'fixedwidth',colourPalette=colourpalette,numCats = 400)

map_world_mortality<-joinCountryData2Map(mapdata_mortality,joinCode = "NAME",nameJoinColumn = "location")
mapCountryData(map_world_mortality,nameColumnToPlot = 'excess_mortality_cumulative_per_million',catMethod = 'fixedwidth',colourPalette=colourpalette,numCats = 400)
```
[Solution text - description of analysis and results]

8. [Solution text - explanations] 
```{r} 
"Do we see a decrease in the risk over time? can you suggest explanations for the observed trends?"

```
[Solution text - description of analysis and results]

9. [Solution text - explanations] 
```{r} 
q_9df <-df[c("location","continent","date","total_deaths","total_cases")]
q_9df$death_rate <-q_9df$total_deaths/q_9df$total_cases
q_9df[q_9df==""]<-NA
q_9df<- na.omit(q_9df)
ggplot(q_9df,aes(x=date, y=death_rate,color=continent))+geom_line()+labs(x="total_deathe", y="date")


# Solution code in R 

```
[Solution text - description of analysis and results]

10. [Solution text - explanations] 
```{r} 
# Solution code in R 

```
[Solution text - description of analysis and results]

11. [Solution text - explanations] 
```{r} 
# Solution code in R 

```
[Solution text - description of analysis and results]

<br/><br/>  



